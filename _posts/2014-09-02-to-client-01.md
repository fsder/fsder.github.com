---
layout: post
title: "给前端同学讲讲后台开发01"
date: "2014-09-02 14:20"
description: ""
category: 
tags: []
---

前言
----

因需要写一些文章来帮助提升技术水平，而自己平时又疏于作书面总结，临时乱诹不免有应付之嫌。
恰逢近日有客户端同学好奇问一些后台的问题，并表达出想要了解服务器实现，并希望能够自己有空写一些服务器程序的热情，窃信以为真。
与其零零散散闲聊一些知识，听者似懂非懂，自己也苦于没有表达清楚。
不如自己先系统的写一些，帮自己整理思路，也能固化知识。
自己明白是一回事，能讲明白是一回事，讲完发现自己依然很明白是另外一会事。
水平有限，只能做到点到为止。

先列一个提纲，能写多少是多少, 感觉可以找几个人一起写会更好。

* 基础概念
* 开发及运行环境
* 实践-写一个多人聊天室服务器
* 常用模式
* 游戏后台的架构
* 。。。

基础概念
--------
很多时候要一起讨论问题，如果对一些概念认识有差异，最后的理解可能会差别太大。
所以有必要整理一些我们经常聊到的概念, 想到什么就写什么。

* 服务器
    当我们说 X86服务器或者刀片服务器，指的是硬件物理机；说linux服务器或者widows服务器，就指的是操作系统. 
    而大多数情况下, 我们谈到服务器，是指运行在相应硬件以及操作系统上的单个程序，或者多个程序集合，甚至是运行在不同物理机的集群。
    从不同的维度，可以有不同的分类，而一般我们会根据应用分为：web服务器、数据库服务器、游戏服务器等。

* 游戏服务器
    从整体上看，所有的后台程序组成了游戏服务器。
    但是正如客户端会分模块，服务器开发中也会按功能划分为不同的模块，不同的是，服务器的模块往往是以几个独立运行的进程为单位，
    比如经常会听到后台同事说到：接入服务器、大区服务器、战斗服务器、工会服务器等。

* 进程
    这应该是一个计算机的基础概念，但是往往因为游戏客户端整个是一个进程，可能很少跳出来思考进程本身、以及进程之间的关系。
    后台的进程往往是7*24小时运行的一个程序，提供相应的服务，如前面提到的大区服务器。

* 堆和栈
    这个有点依赖系统实现和语言，由于很多现代语言提供了垃圾回收的功能，很多时候其实不会太关心。
    但是游戏服务器一般是C／C++，所以这里还是要分清楚的，具体的实现不细述，
    一般而言，在函数中临时定义的变量是在栈上分配(STL等开发库例外)，主动new或者malloc申请的内存是在堆上分配.
    栈有大小，程序启动时会根据系统参数设置栈的容量上限, 存在栈溢出的可能。栈的内存不需要主动释放，会随着函数的退出自动释放。
    堆的大小受限与操作系统，一般64位系统可以理解为没有限制。堆内存要手动管理，存在内存泄漏的风险。

* 内存泄漏
    这也是通用的问题，但是由于服务器程序运行时间更长久，所以遇到的多一点。
    而一般的实践原则是预先分配，采用池来避免这个问题。

* 协议
    因为TCP/IP协议都已经清楚，游戏服务器采用比较多的是TCP长链接。
    而一般我们说的协议则多指具体的业务协议，如登录、攻击等，协议格式现在大多采用的是google protobuf。
    协议定义了前后台交互的接口。

* corefile
    经常听见哪个程序core了，其实应该是说程序崩溃了，产生了内存转储文件corefile。
    corefile是将程序运行时栈保存了起来，对于定位问题很有帮助, 不过这种问题一般应该主要出现在项目初期。
    很多客户端IDE如unity在程序出措时直接就显示出栈信息，一个目的。

开发及运行环境
--------------

经常有人表达出对后台程序员对着黑屏, 像电影中的黑客一样编程的钦佩之情。
其实我觉得可视化编程才是一种进步，尤其是实现一些复杂的算法时，如果能够通过可视化看到程序运行的整个过程，就能很容易的发现问题。 
不过既然说到后台开发，目前绝大多数服务器诚寻都是运行在linux上，所以对linux环境有一个了解是有需要的。

* shell
    是unix／linux下的命令行操作界面，一些常用的命令需要边用边学。
    ls 查看当前目录内容
    cd 切换目录
    ...

* gcc 
    linux 下的C/C++ 编译器

* makefile
    编译工具

这些一般的系统都已经包含了，再加一个编辑器就可以写代码了。

但上面的前提是你有一台可以登录的linux服务器，如果没有，也不原因自己的PC装一个ubuntu一类的桌面linux系统，windows下其实可以搭建服务开发环境的。
当然这里不是说搭建linux环境，也不是使用widows来开发server，而是使用一些跨平台的语言及开发环境来实现。
Java没用过，Python写的多是一些工具，最近恰好对golang感兴趣，所以就拿go语言来说吧。

windows下直接下载go安装包安装即可, 不再赘述。

